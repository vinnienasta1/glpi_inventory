# Руководство по устранению неполадок

## Ошибка: "Ошибка соединения с сервером"

Эта ошибка может возникать по нескольким причинам. Следуйте пунктам ниже для диагностики:

### 1. Проверка установки плагина

**Симптом:** Плагин не отображается в меню или возникают ошибки при загрузке

**Решение:**
1. Убедитесь, что плагин установлен в GLPI:
   - Администрирование → Плагины
   - Найдите "Инвенторизация" в списке
   - Статус должен быть "Установлен" и "Включен"

2. Проверьте структуру файлов:
   ```
   /plugins/inventory/
   ├── setup.php
   ├── inc/inventory.class.php
   ├── front/inventory.php
   ├── ajax/search.php
   └── ...
   ```

### 2. Диагностика подключения

**Используйте тестовый файл:**
1. Создайте файл `test/connection_test.php` (уже включен в плагин)
2. Откройте в браузере: `http://your-glpi-site/plugins/inventory/test/connection_test.php`
3. Проверьте все пункты диагностики

### 3. Проверка путей

**Симптом:** 404 ошибка при AJAX запросах

**Решение:**
1. Убедитесь, что файл `ajax/search.php` доступен по адресу:
   `http://your-glpi-site/plugins/inventory/ajax/search.php`

2. Проверьте права доступа к файлам:
   - Файлы должны быть читаемы веб-сервером
   - Рекомендуемые права: 644 для файлов, 755 для папок

### 4. Проверка базы данных

**Симптом:** Ошибки поиска или "Проблема с подключением к базе данных"

**Решение:**
1. Проверьте наличие таблиц:
   - `glpi_computers`
   - `glpi_monitors` 
   - `glpi_peripherals`

2. Убедитесь, что пользователь GLPI имеет права на чтение этих таблиц

### 5. Отладка JavaScript

**Включите режим отладки:**
1. Откройте файл `front/inventory.php`
2. Измените `$debug_mode = false;` на `$debug_mode = true;`
3. Откройте консоль браузера (F12) и проверьте сообщения

**Проверка в консоли браузера:**
1. Откройте F12 → Console
2. Выполните поиск
3. Ищите ошибки красного цвета

### 6. Проверка прав доступа

**Симптом:** "Недостаточно прав доступа"

**Решение:**
1. Убедитесь, что пользователь авторизован в GLPI
2. Пользователь должен иметь права на конфигурацию (config)
3. Попробуйте с административной учетной записью

### 7. Проверка логов

**Логи GLPI:**
1. Администрирование → Логи
2. Найдите ошибки, связанные с плагином

**Логи веб-сервера:**
- Apache: `/var/log/apache2/error.log`
- Nginx: `/var/log/nginx/error.log`

**Логи PHP:**
- Проверьте `php_error.log`

### 8. Распространенные проблемы

#### Проблема: CSRF ошибки
**Симптом:** "Ошибка безопасности: недействительный CSRF токен"
**Решение:** 
- Обновите страницу (F5)
- Проверьте, что вы авторизованы в GLPI
- Убедитесь, что куки включены в браузере

#### Проблема: CORS ошибки
**Решение:** Убедитесь, что AJAX запросы идут на тот же домен

#### Проблема: Сессия истекла
**Решение:** Перезайдите в GLPI

#### Проблема: Кеширование браузера
**Решение:** Очистите кеш браузера (Ctrl+F5)

#### Проблема: Неправильная кодировка
**Решение:** Убедитесь, что все файлы сохранены в UTF-8

### 9. Тестирование функционала

**Ручной тест AJAX:**
```javascript
// В консоли браузера на странице плагина:
fetch('/plugins/inventory/ajax/search.php', {
    method: 'POST',
    body: new FormData(Object.assign(document.createElement('form'), {
        innerHTML: '<input name="search_serial" value="test">'
    }))
})
.then(r => r.json())
.then(console.log)
.catch(console.error);
```

### 10. Откат изменений

Если проблемы не решаются:
1. Отключите плагин в GLPI
2. Удалите плагин
3. Переустановите с чистыми файлами

### 11. Получение помощи

При обращении за помощью приложите:
1. Результаты диагностики из `connection_test.php`
2. Скриншоты ошибок из консоли браузера
3. Версию GLPI и PHP
4. Описание действий, которые привели к ошибке

### 12. Контрольный список

- [ ] Плагин установлен и включен в GLPI
- [ ] Файл `ajax/search.php` доступен
- [ ] Права доступа к файлам корректны
- [ ] Подключение к БД работает
- [ ] Таблицы GLPI доступны
- [ ] JavaScript не блокируется браузером
- [ ] Нет ошибок в логах
- [ ] Пользователь имеет необходимые права

**После решения проблемы не забудьте:**
- Отключить режим отладки
- Удалить тестовые файлы
- Очистить логи
